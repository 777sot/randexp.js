//
// randexp
//
// Copyright (C) 2011 by Roly Fentanes (https://github.com/fent)
// 
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
// 
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
// 
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE. 
//
(function(){var a=exports.types={POSITION:0,CLASS:2,RANGE:3,CLAUSE:6,REFERENCE:7,INTS:"0123456789",WORDS:"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",WHITESPACE:" \f\n\r\t  ᠎           \u2028\u2029\u2028\u2029  　"};const b="@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^ ?",c={0:0,t:9,n:10,v:11,f:12,r:13};var d=exports.util={rndChar:function(a){return a[Math.floor(Math.random()*a.length)]},anyRndChar:function(){return String.fromCharCode(d.rndInt(0,65535))},strToChars:function(a){var d=/\\(?:u([A-F0-9]{4})|x([A-F0-9]{2})|(0?[0-7]{2})|c([@A-Z\[\\\]^?])|([0tnvfr]))/g;return a=a.replace(d,function(a,d,e,f,g,h){var i=d?parseInt(d,16):e?parseInt(e,16):f?parseInt(f,8):g?b.indexOf(g):h?c[h]:undefined,j;return i!==undefined?(j=String.fromCharCode(i),j=j.replace(/[[\]{}^$.|?*+()]/g,function(a){return"\\"+a})):j="\\"+h,j}),a},rndInt:function(a,b){return a+Math.floor(Math.random()*(1+b-a))},findChar:function(a){var b="\\",c="]",d=0;for(;;){var e=a.indexOf(c);if(a[e-1]===b)a=a.slice(++e),d+=e;else return d+e}},range:function(b,c,d){var e=a.WORDS;return e.slice(e.indexOf(c),e.indexOf(d)+1)},classRange:function(a){return a.replace(/(\w)-(\w)/g,d.range)},toBothCases:function(a){var b=a;return b+=a["to"+(a===a.toLowerCase()?"Upper":"Lower")+"Case"](),b},inCaseClass:function(a,b){return b?(a=a.replace(/[a-zA-Z]/g,function(a){return d.toBothCases(a)}),a):a},inCaseChar:function(b,c){return c&&/[a-zA-Z]/.test(b)?{type:a.CLASS,chars:d.toBothCases(b)}:b},flatten:function(a){for(var b=0;b<a.length-1;b++)if(typeof a[b]=="string"){var c=b+1;for(;;){var d=a[c];if(typeof d=="string")a[b]+=d,a.splice(c,1);else break}}return a.length===1?a[0]:a},reduce:function(a){if(a.stack)a.stack=d.flatten(a.stack);else if(a.options)for(var b=0,c=a.options.length;b<c;b++)a.options[b]=d.flatten(a.options[b]);return a.options||a.group||a.value?a:a.stack},nextClose:function(a){var b=0;for(var c=0,d=a.length;c<d;c++){var e=a[c];switch(e){case")":if(b===0)return c+1;b--;break;case"(":b++;break;case"\\":c++}}}};const e={type:a.POSITION,value:"b"},f={type:a.POSITION,value:"B"},g={type:a.POSITION,value:"^"},h={type:a.POSITION,value:"$"},i={type:a.CLASS,chars:a.WORDS},j={type:a.CLASS,chars:a.WORDS,not:!0},k={type:a.CLASS,chars:a.INTS},l={type:a.CLASS,chars:a.INTS,not:!0},m={type:a.CLASS,chars:a.WHITESPACE},n={type:a.CLASS,chars:a.WHITESPACE,not:!0},o={type:a.CLASS,chars:"\n",not:!0};var p=function(b,c,p){var q=0,r,s={type:a.CLAUSE,stack:[]},t=s,u=s.stack,v=[];b=d.strToChars(b);while(q<b.length){r=b[q++];switch(r){case"\\":r=b[q++];switch(r){case"b":u.push(e);break;case"B":u.push(f);break;case"w":u.push(i);break;case"W":u.push(j);break;case"d":u.push(k);break;case"D":u.push(l);break;case"s":u.push(m);break;case"S":u.push(n);break;default:/\d/.test(r)?u.push({type:a.REFERENCE,value:parseInt(r)}):u.push(r)}break;case"^":u.push(g);break;case"$":u.push(h);break;case"[":r=b[q];if(r==="\\"&&b.slice(q+1).indexOf("b]")===0)q+=3,u.push("\b");else{var w;r==="^"?(w=!0,q++):w=!1;var x=b.slice(q),y=d.findChar(x),z=x.substring(0,y);q+=y+1,u.push({type:a.CLASS,chars:d.inCaseClass(d.classRange(z),c),not:w})}break;case".":u.push(o);break;case"(":r=b[q];var A;if(r==="?"){r=b[q+1],q+=2;if(r==="!"){q+=d.nextClose(b.slice(q));break}A=!1}else A=!0;var B={type:a.CLAUSE,group:A,stack:[]};u.push(B),v.push(t),t=B,u=B.stack;break;case")":t=v.pop(),u=t.options?t.options[t.options.length-1]:t.stack;var C=u.length-1;u[C]=d.reduce(u[C]);break;case"|":t.options||(t.options=[t.stack],delete t.stack);var D=[];t.options.push(D),u=D;break;case"{":var E=/^(\d+)(,(\d+)?)?\}/.exec(b.slice(q)),F=parseInt(E[1]),G=E[2]?E[3]?parseInt(E[3]):Infinity:F;q+=E[0].length;var H=u.pop();if(F===G)for(var I=0;I<F;I++)u.push(H);else u.push({type:a.RANGE,min:F,max:G,value:H});break;case"?":var H=u.pop();u.push({type:a.RANGE,min:0,max:1,value:H});break;case"+":var H=u.pop();u.push({type:a.RANGE,min:1,max:Infinity,value:H});break;case"*":var H=u.pop();u.push({type:a.RANGE,min:0,max:Infinity,value:H});break;default:u.push(d.inCaseChar(r,c))}}return d.reduce(s)},q=function(b,c,e,f){if(typeof b=="string")return b;if(b.length){var g="";for(var h=0,i=b.length;h<i;h++)g+=q(b[h],c,e,f);return g}switch(b.type){case a.POSITION:return"";case a.CLASS:if(!b.not)return d.rndChar(b.chars);for(;;){var j=e();if(b.chars.indexOf(j)===-1)return j};case a.RANGE:var k=d.rndInt(b.min,b.max===Infinity?b.min+c:b.max),g="";for(var h=0;h<k;h++)g+=q(b.value,c,e,f);return g;case a.CLAUSE:if(b.options){var k=d.rndInt(0,b.options.length-1);return q(b.options[k],c,e,f)}var l=q(b.stack,c,e,f);return f.push(l),l;case a.REFERENCE:return f[b.value-1]}};RegExp.prototype.__defineGetter__("gen",function(){return this._randexp===undefined&&(this._randexp=p(this.source,this.ignoreCase,this.multiline),this._max=this._max||100,this._anyRndChar=this._anyRndChar||d.anyRndChar),q(this._randexp,this._max,this._anyRndChar,[])})})();